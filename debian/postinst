#!/bin/bash
set -e

echo "Post-install script running..."

#ensure config directory exists
mkdir -p /etc/temp_daemon
chown root:root /etc/temp_daemon
chmod 755 /etc/temp_daemon

#DEBHELPER#

SERVICE_NAME=temp_daemon
CONFIG_PATH=/etc/temp_daemon/config.toml
MARKER_FILE=/etc/temp_daemon/.configured

if [ "$1" = "configure" ]; then
    if [ ! -f "$MARKER_FILE" ]; then
        echo "First-time install detected."
        echo "Please edit the config file at: $CONFIG_PATH"
        echo "Once configured, run: sudo systemctl start $SERVICE_NAME"
        touch "$MARKER_FILE"
    else
        echo "Upgrade detected. Restarting service..."
        systemctl daemon-reexec
        systemctl daemon-reload
        systemctl restart "$SERVICE_NAME"
    fi
fi
